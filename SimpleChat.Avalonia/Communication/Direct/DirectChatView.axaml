<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:SimpleChat.Avalonia.Communication.Direct"
             xmlns:communication="clr-namespace:SimpleChat.Avalonia.Communication"
             xmlns:behaviors="clr-namespace:SimpleChat.Avalonia.Behaviors"
             xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="300"
             x:Class="SimpleChat.Avalonia.Communication.Direct.DirectChatView"
             x:DataType="local:IDirectChatDataContext"
             d:DataContext="{x:Static local:DesignDirectChatDataContext.WithMessages}">
    <Grid RowDefinitions="* Auto"
          ColumnDefinitions="* Auto">
        <StackPanel Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    IsVisible="{Binding !Messages.Count}">
            <icons:MaterialIcon Width="200"
                                Height="200"
                                Opacity="0.1"
                                Kind="Forum"
                                HorizontalAlignment="Center"/>
            <TextBlock Text="No messages yet"
                       HorizontalAlignment="Center"
                       FontSize="15"
                       FontWeight="Bold"
                       Opacity="0.4"/>
        </StackPanel>
        <ScrollViewer Grid.Row="0"
                      Grid.Column="0"
                      Grid.ColumnSpan="2">
            <Interaction.Behaviors>
                <behaviors:ExecuteCommandWhenScrollingToBegin Command="{Binding LoadMoreMessagesCommand}"
                                                              Threshold="100"/>
            </Interaction.Behaviors>
            <ItemsControl ItemsSource="{Binding Messages}"
                          Margin="0 12">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Spacing="8"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Styles>
                    <Style Selector="local|DirectMessageItem">
                        <Setter Property="HorizontalAlignment" Value="Left"/>
                        <Style Selector="^.outgoing">
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                        </Style>
                    </Style>
                </ItemsControl.Styles>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <local:DirectMessageItem Classes.outgoing="{Binding Type, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static communication:MessageType.Outgoing}}"
                                                 MaxWidth="300"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        <TextBox Grid.Row="1"
                 Grid.Column="0"
                 Text="{Binding Message}"
                 CornerRadius="0"
                 Watermark="Write a message...">
            <Interaction.Behaviors>
                <ExecuteCommandOnKeyDownBehavior Key="Enter"
                                                 Command="{Binding SendMessageCommand}"/>
            </Interaction.Behaviors>
        </TextBox>
        <Button Grid.Row="1"
                Grid.Column="1"
                Content="{icons:MaterialIconExt Kind=Send, Size=24}"
                Command="{Binding SendMessageCommand}"
                Width="40"
                Height="40"
                Padding="0"
                CornerRadius="0"/>
    </Grid>
</UserControl>